<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>One World One Centre — Intake Wizard & Yellow Form</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- html2pdf bundle -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
</head>

<body class="bg-yellow-100 p-6">

  <!-- Wizard Root (pages 1-6 content as you provided) -->
  <div id="wizardRoot" class="max-w-5xl mx-auto bg-white p-6 rounded-lg shadow">

    <h1 class="text-xl font-bold mb-4">Intake Wizard</h1>

    <!-- Date & Contact -->
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block font-semibold">Date</label>
        <input id="date" type="date" class="border p-2 w-full" />
      </div>
      <div>
        <label class="block font-semibold">Taken By</label>
        <input id="takenBy" type="text" class="border p-2 w-full" />
      </div>
    </div>

    <div class="grid grid-cols-3 gap-4 mt-4">
      <div>
        <label class="block font-semibold">Contact Name/Surname</label>
        <input id="contactName" type="text" class="border p-2 w-full" />
      </div>
      <div>
        <label class="block font-semibold">Contact Phone #</label>
        <input id="contactPhone" type="text" class="border p-2 w-full" />
      </div>
      <div>
        <label class="block font-semibold">Relationship</label>
        <input id="contactRel" type="text" class="border p-2 w-full" />
      </div>
    </div>

    <!-- Student Status -->
    <div class="mt-4">
      <label class="block font-semibold">Student's Status</label>
      <label class="mr-2"><input type="radio" name="studentStatus" value="PR" /> PR</label>
      <label class="mr-2"><input type="radio" name="studentStatus" value="RC" /> RC</label>
      <label class="mr-2"><input type="radio" name="studentStatus" value="SP" /> SP</label>
      <label class="mr-2"><input type="radio" name="studentStatus" value="WP" /> WP</label>
    </div>

    <div class="mt-4">
      <label class="block font-semibold">Immigration Document</label>
      <label class="mr-2"><input type="radio" name="immDoc" value="PR" /> PR</label>
      <label class="mr-2"><input type="radio" name="immDoc" value="RC" /> RC</label>
      <label class="mr-2"><input type="radio" name="immDoc" value="SP" /> SP</label>
      <label class="mr-2"><input type="radio" name="immDoc" value="WP" /> WP</label>
    </div>

    <div class="grid grid-cols-2 gap-4 mt-4">
      <div>
        <label class="block font-semibold">Expiry Date (RC/SP/WP)</label>
        <input id="expiry" type="date" class="border p-2 w-full" />
      </div>
      <div>
        <label class="block font-semibold">Previous Attendance in Canadian Schools?</label>
        <label class="mr-2"><input type="radio" name="prevAttend" value="Yes" /> Yes</label>
        <label class="mr-2"><input type="radio" name="prevAttend" value="No" /> No</label>
        <input id="prevDetails" type="text" class="border p-2 w-full mt-1" placeholder="Where / Grade / For how long" />
      </div>
    </div>

    <div class="mt-4">
      <label class="block font-semibold">Date Student(s) Landed in Canada</label>
      <input id="landed" type="date" class="border p-2 w-full" />
    </div>

    <!-- Parents -->
    <div class="grid grid-cols-2 gap-4 mt-4">
      <div>
        <label class="block font-semibold">Father's Surname</label>
        <input id="fatherSurname" type="text" class="border p-2 w-full" />
      </div>
      <div>
        <label class="block font-semibold">Father's Given Name</label>
        <input id="fatherGiven" type="text" class="border p-2 w-full" />
      </div>
    </div>

    <div class="grid grid-cols-2 gap-4 mt-4">
      <div>
        <label class="block font-semibold">Mother's Surname</label>
        <input id="motherSurname" type="text" class="border p-2 w-full" />
      </div>
      <div>
        <label class="block font-semibold">Mother's Given Name</label>
        <input id="motherGiven" type="text" class="border p-2 w-full" />
      </div>
    </div>

    <!-- Address -->
    <div class="grid grid-cols-3 gap-4 mt-4">
      <div>
        <label class="block font-semibold">Apartment #</label>
        <input id="apt" type="text" class="border p-2 w-full" />
      </div>
      <div>
        <label class="block font-semibold">Family Address</label>
        <input id="address" type="text" class="border p-2 w-full" />
      </div>
      <div>
        <label class="block font-semibold">Postal Code</label>
        <input id="postal" type="text" class="border p-2 w-full" />
      </div>
    </div>

    <div class="grid grid-cols-3 gap-4 mt-4">
      <div>
        <label class="block font-semibold">Family Phone #</label>
        <input id="familyPhone" type="text" class="border p-2 w-full" />
      </div>
      <div>
        <label class="block font-semibold">Home Language</label>
        <input id="homeLang" type="text" class="border p-2 w-full" />
      </div>
      <div>
        <label class="block font-semibold">Catholic</label>
        <label class="mr-2"><input type="radio" name="catholic" value="Yes" /> Yes</label>
        <label class="mr-2"><input type="radio" name="catholic" value="No" /> No</label>
      </div>
    </div>

    <!-- Students -->
    <div class="mt-6">
      <h2 class="font-bold mb-2">Students</h2>
      <div id="students"></div>
      <button type="button" onclick="addStudent()" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded">Add Student</button>
    </div>

    <!-- Limited Schooling + Notes -->
    <div class="mt-6">
      <label class="block font-semibold">Potential Limited Formal Schooling Profile</label>
      <label class="mr-2"><input type="radio" name="limitedProfile" value="Yes" /> Yes</label>
      <label class="mr-2"><input type="radio" name="limitedProfile" value="No" /> No</label>
    </div>

    <div class="mt-4">
      <label class="block font-semibold">Notes</label>
      <textarea id="notes" rows="4" class="border p-2 w-full"></textarea>
    </div>

    <!-- Generate -->
    <div class="mt-6">
      <button type="button" onclick="generateFinal()" class="px-6 py-2 bg-green-600 text-white rounded">Generate Yellow Form</button>
    </div>
  </div>

  <!-- Final Form -->
  <div id="finalWrap" class="hidden max-w-6xl mx-auto mt-6 bg-white p-6 rounded-lg shadow">
    <div class="flex justify-between mb-4">
      <h2 class="text-xl font-bold">Yellow Form</h2>
      <div>
        <button id="editBtn" class="px-4 py-2 bg-gray-400 text-white rounded">Edit</button>
        <button id="pdfBtn" class="px-4 py-2 bg-blue-600 text-white rounded ml-2">Download PDF</button>
      </div>
    </div>
    <div id="finalArea" class="text-sm"></div>
  </div>

  <script>
    // core state
    let studentCount = 0;

    // add student card to wizard
    function addStudent() {
      studentCount++;
      const div = document.createElement('div');
      div.className = "border p-4 mb-2 rounded bg-gray-50";
      div.id = `student-card-${studentCount}`;
      div.innerHTML = `
        <h3 class="font-semibold mb-2">Student ${studentCount}</h3>
        <div class="grid grid-cols-2 gap-4">
          <div><label class="block text-sm">Surname</label><input id="s_${studentCount}_surname" type="text" class="border p-2 w-full" /></div>
          <div><label class="block text-sm">Given Name</label><input id="s_${studentCount}_given" type="text" class="border p-2 w-full" /></div>
        </div>
        <div class="grid grid-cols-4 gap-2 mt-2">
          <div>
            <label class="block text-sm">Gender</label>
            <label class="mr-2"><input type="radio" name="s_${studentCount}_gender" value="F" /> F</label>
            <label class="mr-2"><input type="radio" name="s_${studentCount}_gender" value="M" /> M</label>
          </div>
          <div>
            <label class="block text-sm">DOB</label><input id="s_${studentCount}_dob" type="date" class="border p-2 w-full" />
          </div>
          <div>
            <label class="block text-sm">Birth Country</label><input id="s_${studentCount}_birth" type="text" class="border p-2 w-full" />
          </div>
          <div>
            <label class="block text-sm">Last Grade Completed</label><input id="s_${studentCount}_lastgrade" type="text" class="border p-2 w-full" />
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4 mt-2">
          <div>
            <label class="block text-sm">School Year</label>
            <label class="mr-2"><input type="radio" name="s_${studentCount}_year" value="ThisYear" /> This Year</label>
            <label class="mr-2"><input type="radio" name="s_${studentCount}_year" value="NextYear" /> Next Year</label>
          </div>
          <div>
            <label class="block text-sm">Program</label>
            <label class="mr-2"><input type="radio" name="s_${studentCount}_prog" value="No" /> No</label>
            <label class="mr-2"><input type="radio" name="s_${studentCount}_prog" value="Yes" /> Yes</label>
            <input id="s_${studentCount}_prog_spec" type="text" class="border p-1 w-full mt-1" placeholder="Specify if Yes" />
          </div>
        </div>
      `;
      document.getElementById('students').appendChild(div);
      // scroll into view
      div.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // helper functions
    function checkboxMark(cond) { return cond ? '☑' : '☐'; }
    function getRadioValue(name) {
      const r = document.querySelector(`input[name='${name}']:checked`);
      return r ? r.value : '';
    }
    function valById(id) {
      const el = document.getElementById(id);
      return el ? el.value : '';
    }

    // generate the final yellow form (table-based)
    function generateFinal() {
      const final = document.getElementById('finalArea');
      final.innerHTML = '';

      // main table (uses 4 columns for top info)
      const tbl = document.createElement('table');
      tbl.className = 'w-full border-collapse text-sm';
      tbl.style.border = "1px solid #000";

      function addRow(label, col1, label2, col2) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-2 border font-semibold w-48 align-top">${label}</td>
          <td class="p-2 border">${col1 || ''}</td>
          <td class="p-2 border font-semibold w-48 align-top">${label2 || ''}</td>
          <td class="p-2 border">${col2 || ''}</td>
        `;
        tbl.appendChild(tr);
      }

      // Top info rows (exact as your wizard fields)
      addRow('DATE', valById('date'), 'TAKEN BY', valById('takenBy'));
      addRow('CONTACT NAME/SURNAME', valById('contactName'), 'CONTACT PHONE #', valById('contactPhone'));
      addRow('CONTACT RELATIONSHIP', valById('contactRel'), '', '');

      addRow("STUDENT'S STATUS", getRadioValue('studentStatus'), 'IMMIGRATION DOCUMENT (OF NATURAL PARENT / GUARDIAN)', getRadioValue('immDoc'));
      addRow('EXPIRY DATE (RC/SP/WP)', valById('expiry'), 'PREVIOUS ATTENDANCE IN CANADIAN SCHOOLS?',
        (function () {
          const val = getRadioValue('prevAttend');
          if (val === 'Yes') return `${checkboxMark(true)} Yes   ${checkboxMark(false)} No`;
          if (val === 'No') return `${checkboxMark(false)} Yes   ${checkboxMark(true)} No`;
          return '';
        })()
      );
      addRow('DATE STUDENT(S) LANDED IN CANADA', valById('landed'), 'PREVIOUS DETAILS', valById('prevDetails'));

      addRow("FATHER'S SURNAME", valById('fatherSurname'), "FATHER'S GIVEN NAME", valById('fatherGiven'));
      addRow("MOTHER'S SURNAME", valById('motherSurname'), "MOTHER'S GIVEN NAME", valById('motherGiven'));

      addRow('APARTMENT #', valById('apt'), 'FAMILY ADDRESS', valById('address') + (valById('postal') ? ' / ' + valById('postal') : ''));
      addRow('FAMILY PHONE #', valById('familyPhone'), 'HOME LANGUAGE', valById('homeLang'));
      addRow('CATHOLIC', '', '', (function () {
        const c = getRadioValue('catholic');
        return `${checkboxMark(c === 'Yes')} Yes   ${checkboxMark(c === 'No')} No`;
      })());

      // STUDENT BLOCK as a nested table so top-level columns stay consistent
      const studentRow = document.createElement('tr');
      const studentCell = document.createElement('td');
      studentCell.colSpan = 4;
      studentCell.className = 'p-0 border';

      const studentTable = document.createElement('table');
      studentTable.className = 'w-full border-collapse text-sm';
      studentTable.style.border = "1px solid #000";

      // student header (8 columns)
      const sHead = document.createElement('tr');
      sHead.innerHTML = `
        <th class="p-2 border font-semibold w-32">STUDENT'S SURNAME</th>
        <th class="p-2 border font-semibold w-32">STUDENT'S GIVEN NAME</th>
        <th class="p-2 border font-semibold w-16">GENDER</th>
        <th class="p-2 border font-semibold w-28">DOB (MMM/DD/YYYY)</th>
        <th class="p-2 border font-semibold w-28">BIRTH COUNTRY</th>
        <th class="p-2 border font-semibold w-28">LAST GRADE COMPLETED</th>
        <th class="p-2 border font-semibold w-28">SCHOOL YEAR</th>
        <th class="p-2 border font-semibold w-28">PROGRAM</th>
      `;
      studentTable.appendChild(sHead);

      // each student row
      for (let i = 1; i <= studentCount; i++) {
        const sSurnameEl = document.getElementById(`s_${i}_surname`);
        const sGivenEl = document.getElementById(`s_${i}_given`);
        const sDobEl = document.getElementById(`s_${i}_dob`);
        const sBirthEl = document.getElementById(`s_${i}_birth`);
        const sLastEl = document.getElementById(`s_${i}_lastgrade`);
        const sProgSpecEl = document.getElementById(`s_${i}_prog_spec`);

        const surname = sSurnameEl ? sSurnameEl.value : '';
        const given = sGivenEl ? sGivenEl.value : '';
        const gender = getRadioValue(`s_${i}_gender`);
        const dob = sDobEl ? sDobEl.value : '';
        const birth = sBirthEl ? sBirthEl.value : '';
        const last = sLastEl ? sLastEl.value : '';
        const year = getRadioValue(`s_${i}_year`);
        const prog = getRadioValue(`s_${i}_prog`);
        const progSpec = sProgSpecEl ? sProgSpecEl.value : '';

        if (surname || given || birth || last) {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="p-2 border">${escapeHtml(surname)}</td>
            <td class="p-2 border">${escapeHtml(given)}</td>
            <td class="p-2 border text-center">${checkboxMark(gender === 'F')} F&nbsp;&nbsp;${checkboxMark(gender === 'M')} M</td>
            <td class="p-2 border text-center">${escapeHtml(dob)}</td>
            <td class="p-2 border">${escapeHtml(birth)}</td>
            <td class="p-2 border text-center">${escapeHtml(last)}</td>
            <td class="p-2 border text-center">${year === 'ThisYear' ? 'This year' : (year === 'NextYear' ? 'Next year' : '')}</td>
            <td class="p-2 border text-center">${prog === 'Yes' ? 'Yes — ' + escapeHtml(progSpec) : (prog === 'No' ? 'No' : '')}</td>
          `;
          studentTable.appendChild(row);
        }
      }

      studentCell.appendChild(studentTable);
      studentRow.appendChild(studentCell);
      tbl.appendChild(studentRow);

      // Potential limited formal schooling profile row (below students)
      const limited = getRadioValue('limitedProfile');
      const trLimited = document.createElement('tr');
      trLimited.innerHTML = `
        <td class="p-2 border font-semibold" colspan="2">POTENTIAL LIMITED FORMAL SCHOOLING PROFILE</td>
        <td class="p-2 border" colspan="2">${checkboxMark(limited === 'Yes')} Yes&nbsp;&nbsp;${checkboxMark(limited === 'No')} No
          <div class="text-xs italic mt-1">If YES, describe for each student, Grade 1 – Grade 12, as relevant. Number of years as refugees, country of relocation, refugee camp name, nature of schooling, parent country of origin.</div>
        </td>
      `;
      tbl.appendChild(trLimited);

      // Notes row
      const trNotes = document.createElement('tr');
      trNotes.innerHTML = `
        <td class="p-2 border font-semibold" colspan="2">NOTES</td>
        <td class="p-2 border" colspan="2" style="height:80px; vertical-align:top;">${escapeHtml(valById('notes'))}</td>
      `;
      tbl.appendChild(trNotes);

      // Rev row
      const trRev = document.createElement('tr');
      trRev.innerHTML = `
        <td class="p-2 border text-xs italic text-right" colspan="4">Rev. 2021</td>
      `;
      tbl.appendChild(trRev);

      final.appendChild(tbl);

      // swap view
      document.getElementById('wizardRoot').classList.add('hidden');
      document.getElementById('finalWrap').classList.remove('hidden');

      // PDF button (use html2pdf)
      document.getElementById('pdfBtn').onclick = () => {
        const opt = {
          margin: 0.2,
          filename: 'one-world-one-centre-intake.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
        };
        html2pdf().set(opt).from(document.getElementById('finalArea')).save();
      };
    }

    // edit button to go back to wizard
    document.getElementById('editBtn').addEventListener('click', () => {
      document.getElementById('finalWrap').classList.add('hidden');
      document.getElementById('wizardRoot').classList.remove('hidden');
      // allow user to continue editing; scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // simple HTML-escape for safety
    function escapeHtml(str) {
      if (!str) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }
  </script>
</body>

</html>
