<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Intake Wizard with Yellow Form</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }

    .wizard {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 800px;
      margin: auto;
      min-height: 650px; /* ✅ consistent background size */
    }

    .page {
      min-height: 550px; /* ✅ all pages same base height */
    }

    .hidden { display: none; }

    .buttons {
      margin-top: 20px;
    }

    button {
      padding: 10px 15px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      background-color: #007BFF;
      color: white;
      cursor: pointer;
    }

    button:hover { background-color: #0056b3; }

    label { display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; }

    #finalWrap {
      max-width: 1000px;
      margin: auto;
      background: #fffbe6;
      padding: 20px;
      border: 2px solid #000;
    }

    #finalArea table {
      border-collapse: collapse;
      width: 100%;
      font-size: 12px;
    }

    #finalArea th, #finalArea td {
      border: 1px solid #000;
      padding: 4px;
      text-align: left;
    }

    #finalArea th {
      background: #ffeb99;
    }

    @media print {
      body { background: white; }
      .wizard, .buttons { display: none; }
      #finalWrap { border: none; }
    }
  </style>
</head>
<body>

<div id="wizard" class="wizard">
  <!-- Step 1 -->
  <div class="page" data-step="1">
    <h2>Step 1: Contact Info</h2>
    <label>Contact Name: <input id="contactName"></label>
    <label>Contact Phone: <input id="contactPhone"></label>
    <label>Contact Relationship: <input id="contactRel"></label>
    <div class="buttons">
      <button onclick="goTo(2)">Next</button>
    </div>
  </div>

  <!-- Step 2 -->
  <div class="page hidden" data-step="2">
    <h2>Step 2: Family Info</h2>
    <label>Father Surname: <input id="fatherSurname"></label>
    <label>Father Given: <input id="fatherGiven"></label>
    <label>Mother Surname: <input id="motherSurname"></label>
    <label>Mother Given: <input id="motherGiven"></label>
    <label>Apartment #: <input id="apt"></label>
    <label>Family Address: <input id="familyAddress"></label>
    <label>Postal Code: <input id="postal"></label>
    <label>Family Phone: <input id="familyPhone"></label>
    <label>Home Language: <input id="homeLang"></label>
    <label>Catholic? 
      <select id="catholic">
        <option value="">Select</option>
        <option>Yes</option>
        <option>No</option>
      </select>
    </label>
    <div class="buttons">
      <button onclick="goTo(1)">Back</button>
      <button onclick="goTo(3)">Next</button>
    </div>
  </div>

  <!-- Step 3 -->
  <div class="page hidden" data-step="3">
    <h2>Step 3: Student Info</h2>
    <div id="students"></div>
    <button onclick="addStudent()">Add Student</button>
    <div class="buttons">
      <button onclick="goTo(2)">Back</button>
      <button onclick="generateFinal()">Finish</button>
    </div>
  </div>
</div>

<!-- Final -->
<div id="finalWrap" class="hidden">
  <div class="buttons">
    <button onclick="backToEdit()">Back to Edit</button>
    <button onclick="printFinal()">Print</button>
    <button onclick="downloadPDF()">Download PDF</button>
  </div>
  <div id="finalArea"></div>
</div>

<script>
function goTo(step){
  document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'))
  document.querySelector(`.page[data-step='${step}']`).classList.remove('hidden')
  window.scrollTo({top:0,behavior:'smooth'})
}

function addStudent(data={}){
  const container=document.getElementById('students')
  const div=document.createElement('div')
  div.className='student'
  div.innerHTML=`
    <hr><label>Surname: <input class="sSurname" value="${data.sSurname||''}"></label>
    <label>Given: <input class="sGiven" value="${data.sGiven||''}"></label>
    <label>Gender: <input class="sGender" value="${data.sGender||''}"></label>
    <label>DOB: <input type="date" class="sDob" value="${data.sDob||''}"></label>
    <label>Birth Country: <input class="sCountry" value="${data.sCountry||''}"></label>
    <label>Last Grade Completed: <input class="sGrade" value="${data.sGrade||''}"></label>
    <label>School Year: <input class="sYear" value="${data.sYear||''}"></label>
    <label>Program: <input class="sProgram" value="${data.sProgram||''}"></label>
    <button type="button" onclick="this.parentElement.remove()">Remove Student</button>
  `
  container.appendChild(div)
}

function escapeHtml(str){return str?str.replace(/[&<>'"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;',"'":'&#39;','"':'&quot;'}[c])):''}

function generateFinal(){
  const contactName=escapeHtml(document.getElementById('contactName').value)
  const contactPhone=escapeHtml(document.getElementById('contactPhone').value)
  const contactRel=escapeHtml(document.getElementById('contactRel').value)
  const fatherSurname=escapeHtml(document.getElementById('fatherSurname').value)
  const fatherGiven=escapeHtml(document.getElementById('fatherGiven').value)
  const motherSurname=escapeHtml(document.getElementById('motherSurname').value)
  const motherGiven=escapeHtml(document.getElementById('motherGiven').value)
  const apt=escapeHtml(document.getElementById('apt').value)
  const familyAddress=escapeHtml(document.getElementById('familyAddress').value)
  const postal=escapeHtml(document.getElementById('postal').value)
  const familyPhone=escapeHtml(document.getElementById('familyPhone').value)
  const homeLang=escapeHtml(document.getElementById('homeLang').value)
  const catholic=escapeHtml(document.getElementById('catholic').value)
  const students=[...document.querySelectorAll('#students .student')].map(div=>({
    sSurname:escapeHtml(div.querySelector('.sSurname').value),
    sGiven:escapeHtml(div.querySelector('.sGiven').value),
    sGender:escapeHtml(div.querySelector('.sGender').value),
    sDob:escapeHtml(div.querySelector('.sDob').value),
    sCountry:escapeHtml(div.querySelector('.sCountry').value),
    sGrade:escapeHtml(div.querySelector('.sGrade').value),
    sYear:escapeHtml(div.querySelector('.sYear').value),
    sProgram:escapeHtml(div.querySelector('.sProgram').value),
  }))

  let html=`<h2 style="text-align:center">YELLOW FORM</h2>
  <table>
    <tr><th>Contact Name</th><td>${contactName}</td><th>Contact Phone</th><td>${contactPhone}</td><th>Relationship</th><td>${contactRel}</td></tr>
    <tr><th>Father Surname</th><td>${fatherSurname}</td><th>Father Given</th><td>${fatherGiven}</td><th>Mother Surname</th><td>${motherSurname}</td><th>Mother Given</th><td>${motherGiven}</td></tr>
    <tr><th>Apartment #</th><td>${apt}</td><th>Family Address</th><td>${familyAddress}</td><th>Postal Code</th><td>${postal}</td></tr>
    <tr><th>Family Phone</th><td>${familyPhone}</td><th>Home Language</th><td>${homeLang}</td><th>Catholic</th><td>${catholic}</td></tr>
  </table>
  <h3>Students</h3>
  <table>
    <tr><th>Surname</th><th>Given</th><th>Gender</th><th>DOB</th><th>Birth Country</th><th>Grade</th><th>Year</th><th>Program</th></tr>`
  students.forEach(s=>{
    html+=`<tr><td>${s.sSurname}</td><td>${s.sGiven}</td><td>${s.sGender}</td><td>${s.sDob}</td><td>${s.sCountry}</td><td>${s.sGrade}</td><td>${s.sYear}</td><td>${s.sProgram}</td></tr>`
  })
  html+=`</table>`
  document.getElementById('finalArea').innerHTML=html
  document.getElementById('wizard').classList.add('hidden')
  document.getElementById('finalWrap').classList.remove('hidden')
  window.scrollTo({top:0,behavior:'smooth'})
}

function backToEdit(){
  document.getElementById('wizard').classList.remove('hidden')
  document.getElementById('finalWrap').classList.add('hidden')
  goTo(1)
}

function printFinal(){window.print()}
function downloadPDF(){
  const element=document.getElementById('finalArea')
  html2pdf().set({margin:0.5,filename:'yellow_form.pdf',html2canvas:{scale:2},jsPDF:{unit:'in',format:'letter',orientation:'portrait'}}).from(element).save()
}

// start with one student
addStudent()
</script>
</body>
</html>
